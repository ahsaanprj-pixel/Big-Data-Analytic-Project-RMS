{% extends 'base.html' %}
{% block title %}Print Receipt{% endblock %}

{% block content %}
   
    <h3 class="mt-4">Print Receipt</h3>
    
    <form method="POST">

        <div class="form-group">
            
            <label>Table Number (1 - {{ max_tables }}):</label>

            <input type="number" name="table_num" class="form-control" min="1" max="{{ max_tables }}" required>
        </div>
        
        <button type="submit" class="btn btn-primary">Load and Print Receipt</button>
        <!-- Warning button to start a new customer session by clearing previous orders for the table -->
        <!-- Includes hidden action parameter to distinguish from print action -->
        <button type="submit" name="action" value="new_customer" class="btn btn-warning">New Customer</button>
    </form>
    
    <!-- Conditional section to display receipt preview if orders exist for the table/session -->
    <!-- Preview shows aggregated orders before printing -->
    {% if orders %}
        <!-- Subheading for the receipt preview -->
        <h4 class="mt-4">Receipt Preview for Current Customer</h4>
        <!-- Table to display order details: ID, product name, quantity, and total price -->
        <table class="table table-striped table-bordered">
            <thead>
                <!-- Table header row defining columns -->
                <tr><th>ID</th><th>Product Name</th><th>Quantity</th><th>Total Price</th></tr>
            </thead>
            <tbody>
                <!-- Loop through orders list to populate table rows -->
                {% for order in orders %}
                    <tr>
                        <!-- Display order ID -->
                        <td>{{ order[0] }}</td>
                        <!-- Display product name -->
                        <td>{{ order[1] }}</td>
                        <!-- Display quantity -->
                        <td>{{ order[2] }}</td>
                        <!-- Display total price, formatted to 2 decimal places -->
                        <td>{{ order[3] | float | round(2) }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}
